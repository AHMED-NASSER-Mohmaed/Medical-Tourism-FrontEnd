<div class="dashboard-container">
  <!-- Dashboard Stats Cards -->
  <div class="row g-4 mb-4">
    @for (stat of [
      { title: 'Total Accounts', value: pagination.totalCount, icon: currentViewConfig.icon, trend: 0 },
      { title: 'Active', value: activeAccountCount, icon: icons.userCheck, trend: calculateTrend(activeAccountCount) },
      { title: 'Pending', value: pendingAccountCount, icon: icons.userClock, trend: calculateTrend(pendingAccountCount) },
      { title: 'Inactive', value: inactiveAccountCount, icon: icons.deactivate, trend: calculateTrend(inactiveAccountCount) }
    ]; track $index) {
      <div class="col-md-6 col-lg-3">
        <app-dashboard-card
          [title]="stat.title"
          [value]="stat.value"
          [icon]="stat.icon"
          [color]="$index === 0 ? currentViewConfig.color : 'primary'"
          [trendValue]="stat.trend"
          [trendUp]="stat.trend > 0">
        </app-dashboard-card>
      </div>
    }
  </div>

  <!-- Main Card -->
  <div class="management-card">
    <!-- Card Header -->
    <div class="card-header">
      <div class="header-content">
        <div class="header-text">
          <h5>{{ currentViewConfig.label }} Management</h5>
          <p>Manage all {{ currentViewConfig.label.toLowerCase() }} accounts in the system</p>
        </div>
        
        <div class="header-actions">
          <!-- Search Box -->
          <div class="search-box">
            <input type="text" 
                   class="search-input"
                   [(ngModel)]="searchTerm" 
                   (keyup.enter)="loadAccounts()"
                   placeholder="Search {{ currentViewConfig.label.toLowerCase() }}...">
            <button class="search-button" (click)="loadAccounts()">
              <fa-icon [icon]="icons.search"></fa-icon>
            </button>
          </div>

          <!-- View Type Toggle -->
          <div class="view-toggle">
            @for (view of viewConfigs; track view.type) {
              <button type="button"
                      class="view-button"
                      [class.active]="currentView === view.type"
                      (click)="changeView(view.type)">
                <fa-icon [icon]="view.icon" class="me-2"></fa-icon>
                {{ view.label }}
              </button>
            }
          </div>
        </div>
      </div>
    </div>

    <!-- Card Body -->
    <div class="card-body">
      @if (errorMessage) {
        <div class="error-alert">
          {{ errorMessage }}
        </div>
      }

      <!-- Accounts Table -->
      <div class="table-responsive">
        <table class="accounts-table">
          <thead>
            <tr>
              <th>User</th>
              <th>Email</th>
              <th>Type</th>
              <th>Status</th>
              <th>Registered</th>
              <th class="text-end">Actions</th>
            </tr>
          </thead>
          <tbody>
            @if (isLoading) {
              <tr>
                <td colspan="6" class="loading-state">
                  <div class="spinner"></div>
                  <span>Loading accounts...</span>
                </td>
              </tr>
            } @else {
              @for (account of accounts; track trackByUserId($index, account)) {
                <tr>
                  <td>
                    <div class="user-info">
                      <div class="avatar-container">
                        <img [src]="account.imageURL || 'assets/images/default-avatar.png'"
                             alt="User avatar"
                             class="user-avatar">
                        <span class="status-indicator"
                              [ngClass]="{
                                'active': account.status === UserStatus.ACTIVE,
                                'pending': account.status === UserStatus.PENDING,
                                'inactive': account.status === UserStatus.INACTIVE,
                                'suspended': account.status === UserStatus.SUSPENDED
                              }"></span>
                      </div>
                      <div class="user-details">
                        <div class="user-name">{{ account.firstName }} {{ account.lastName }}</div>
                        <div class="user-meta">{{ account.phone }}</div>
                      </div>
                    </div>
                  </td>
                  <td>{{ account.email }}</td>
                  <td>
                    <span class="account-type-badge">
                      {{ getUserType(account) }}
                    </span>
                  </td>
                  <td>
                    <span class="status-badge" [ngClass]="getStatusBadgeClass(account.status)">
                      {{ getUserStatusText(account.status) }}
                    </span>
                  </td>
                  <td>
                    {{ account.dateOfBirth | date:'mediumDate' }}
                  </td>
                  <td class="text-end">
                    <div class="action-buttons">
                      <button class="btn-action view" title="View details">
                        <fa-icon [icon]="icons.view"></fa-icon>
                      </button>
                      @if (account.status !== UserStatus.ACTIVE) {
                        <button class="btn-action activate" 
                                title="Activate"
                                (click)="changeUserStatus(account.id, true)"
                                [disabled]="isLoading">
                          <fa-icon [icon]="icons.activate"></fa-icon>
                        </button>
                      }
                      @if (account.status !== UserStatus.INACTIVE) {
                        <button class="btn-action deactivate" 
                                title="Deactivate"
                                (click)="changeUserStatus(account.id, false)"
                                [disabled]="isLoading">
                          <fa-icon [icon]="icons.deactivate"></fa-icon>
                        </button>
                      }
                    </div>
                  </td>
                </tr>
              } @empty {
                <tr>
                  <td colspan="6" class="empty-state">
                    No accounts found
                  </td>
                </tr>
              }
            }
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      @if (pagination.totalPages > 1) {
        <div class="pagination-container">
          <div class="pagination-info">
            Showing {{ (pagination.page - 1) * pagination.pageSize + 1 }} to 
            {{ getToEntry() }} of 
            {{ pagination.totalCount }} entries
          </div>
          
          <nav class="pagination-nav">
            <ul class="pagination">
              <li class="page-item" [class.disabled]="pagination.page === 1">
                <a class="page-link" (click)="onPageChange(pagination.page - 1)">
                  &laquo;
                </a>
              </li>
              
              @for (page of getPageNumbers(); track page) {
                <li class="page-item" 
                    [class.active]="page === pagination.page"
                    [class.disabled]="page === -1">
                  @if (page !== -1) {
                    <a class="page-link" (click)="onPageChange(page)">{{ page }}</a>
                  } @else {
                    <span class="page-link">...</span>
                  }
                </li>
              }
              
              <li class="page-item" [class.disabled]="pagination.page === pagination.totalPages">
                <a class="page-link" (click)="onPageChange(pagination.page + 1)">
                  &raquo;
                </a>
              </li>
            </ul>
          </nav>
        </div>
      }
    </div>
  </div>
</div>