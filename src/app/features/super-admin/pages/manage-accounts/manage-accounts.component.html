<div class="row g-4 mb-4">
  <div class="col-md-6 col-lg-3">
    <app-dashboard-card
      title="Total Accounts"
      [value]="pagination.totalItems"
      [icon]="icons.users"
      color="primary">
    </app-dashboard-card>
  </div>
  <div class="col-md-6 col-lg-3">
    <app-dashboard-card
      title="Active Accounts"
      [value]="activeAccountCount"
      [icon]="icons.userCheck"
      color="success"
      [trendValue]="calculateTrend(activeAccountCount)"
      [trendUp]="calculateTrend(activeAccountCount) > 0">
    </app-dashboard-card>
  </div>
  <div class="col-md-6 col-lg-3">
    <app-dashboard-card
      title="Pending Accounts"
      [value]="pendingAccountCount"
      [icon]="icons.userClock"
      color="warning"
      [trendValue]="calculateTrend(pendingAccountCount)"
      [trendUp]="false">
    </app-dashboard-card>
  </div>
  <div class="col-md-6 col-lg-3">
    <app-dashboard-card
      title="Inactive Accounts"
      [value]="inactiveAccountCount"
      [icon]="icons.userClock"
      color="danger"
      [trendValue]="calculateTrend(inactiveAccountCount)"
      [trendUp]="false">
    </app-dashboard-card>
  </div>
</div>

<div class="card border-0 shadow-lg rounded-4 manage-accounts-card">
  <div class="card-header bg-white py-4 rounded-top-4 border-0">
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-3">
      <div>
        <h5 class="mb-1 fw-bold text-dark">User Account Management</h5>
        <p class="text-muted mb-0">Manage all user accounts in the system</p>
      </div>
      <div class="d-flex flex-wrap align-items-center gap-2">
        <div class="input-group search-group">
          <input type="text" class="form-control rounded-start-3" placeholder="Search accounts..."
                 [(ngModel)]="searchTerm" (keyup.enter)="loadAccounts()">
          <button class="btn btn-primary rounded-end-3" (click)="loadAccounts()">
            <fa-icon [icon]="icons.search"></fa-icon>
          </button>
        </div>
        <div class="btn-group ms-2" role="group">
          <button type="button"
                  class="btn btn-outline-primary"
                  [class.active]="currentView === 'patients'"
                  (click)="changeView('patients')">
            Patients
          </button>
          <button type="button"
                  class="btn btn-outline-primary"
                  [class.active]="currentView === 'hospitals'"
                  (click)="changeView('hospitals')">
            Hospitals
          </button>
          <button type="button"
                  class="btn btn-outline-primary"
                  [class.active]="currentView === 'hotels'"
                  (click)="changeView('hotels')">
            Hotels
          </button>
          <button type="button"
                  class="btn btn-outline-primary"
                  [class.active]="currentView === 'car-rentals'"
                  (click)="changeView('car-rentals')">
            Car Rentals
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-hover align-middle mb-0">
        <thead class="table-light">
          <tr>
            <th>User</th>
            <th>Email</th>
            <th>Type</th>
            <th>Status</th>
            <th>Registered</th>
            <th class="text-end">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let account of accounts; trackBy: trackByUserId">
            <td>
              <div class="d-flex align-items-center">
                <div class="avatar-ring me-2 position-relative">
                  <img [src]="account.imageURL || 'assets/default-avatar.png'"
                       alt="User Avatar" class="rounded-circle" width="40" height="40">
                  <span class="status-dot"
                        [ngClass]="{
                          'bg-success': account.status === UserStatus.ACTIVE,
                          'bg-warning': account.status === UserStatus.PENDING,
                          'bg-danger': account.status === UserStatus.SUSPENDED,
                          'bg-secondary': account.status === UserStatus.INACTIVE
                        }"></span>
                </div>
                <div>
                  <div class="fw-semibold text-dark">{{ account.firstName }} {{ account.lastName }}</div>
                  <small class="text-muted">{{ account.userName }}</small>
                </div>
              </div>
            </td>
            <td>{{ account.email }}</td>
            <td>
              <span class="badge bg-soft-primary text-primary fw-semibold px-3 py-2 rounded-pill">
                {{ getUserType(account) }}
              </span>
            </td>
            <td>
              <span class="badge px-3 py-2 rounded-pill fw-semibold"
                    [ngClass]="getStatusBadgeClass(account.status)">
                {{ getUserStatusText(account.status) }}
              </span>
            </td>
            <td>
              <span class="text-nowrap">
                {{ account.dateOfBirth | date:'mediumDate' }}
              </span>
            </td>
            <td class="text-end">
              <div class="btn-group btn-group-sm" role="group">
                <button class="btn btn-outline-primary" title="View Details">
                  <fa-icon [icon]="icons.view"></fa-icon>
                </button>
                <button class="btn btn-outline-success"
                        *ngIf="account.status !== UserStatus.ACTIVE"
                        (click)="activateUser(account.id)"
                        title="Activate"
                        [disabled]="isLoading">
                  <fa-icon [icon]="icons.activate"></fa-icon>
                </button>
                <button class="btn btn-outline-warning"
                        *ngIf="account.status !== UserStatus.INACTIVE"
                        (click)="deactivateUser(account.id)"
                        title="Deactivate"
                        [disabled]="isLoading">
                  <fa-icon [icon]="icons.deactivate"></fa-icon>
                </button>
              </div>
            </td>
          </tr>

          <!-- Loading Spinner -->
          <tr *ngIf="isLoading">
            <td colspan="6" class="text-center py-4">
              <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
            </td>
          </tr>

          <!-- No Results -->
          <tr *ngIf="!isLoading && accounts.length === 0">
            <td colspan="6" class="text-center py-4 text-muted">
              No accounts found
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-center gap-2 p-3" *ngIf="pagination.totalPages > 1">
      <div class="text-muted small">
        Showing <strong>{{ (pagination.page - 1) * pagination.limit + 1 }}</strong> to
        <strong>{{ Math.min(pagination.page * pagination.limit, pagination.totalItems) }}</strong> of
        <strong>{{ pagination.totalItems }}</strong> entries
      </div>
      <nav>
        <ul class="pagination pagination-sm mb-0">
          <li class="page-item" [class.disabled]="pagination.page === 1">
            <a class="page-link" (click)="onPageChange(pagination.page - 1)" aria-label="Previous">
              &laquo;
            </a>
          </li>
          <li class="page-item" *ngFor="let page of getPageNumbers()"
              [class.active]="page === pagination.page"
              [class.disabled]="page === -1">
            <a *ngIf="page !== -1" class="page-link" (click)="onPageChange(page)">{{ page }}</a>
            <span *ngIf="page === -1" class="page-link disabled">...</span>
          </li>
          <li class="page-item" [class.disabled]="pagination.page === pagination.totalPages">
            <a class="page-link" (click)="onPageChange(pagination.page + 1)" aria-label="Next">
              &raquo;
            </a>
          </li>
        </ul>
      </nav>
    </div>
  </div>
</div>